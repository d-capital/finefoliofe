

<ng-container *ngIf="loading">
  <ng-template [ngTemplateOutlet]="loadingSkeleton"></ng-template>
</ng-container>

<ng-container *ngIf="error">
  <ng-template [ngTemplateOutlet]="errorTemplate"></ng-template>
</ng-container>

<ng-container *ngIf="!loading && !error;">
    <div class="valuate-container">
      <section class="top-card">
        <h1>{{ stockInfo.name }}</h1>
        <h4>{{ ticker }} * {{ exchange }}</h4>
        <h1>${{ uiRounding(stockInfo.price) }}</h1>
      </section>

      <app-tabs>
        <app-tab title="{{valuationOverviewLabel}}">
          <div *ngIf="valuation.avgGrowth === null">
            <h2 style="color: grey;">{{ noValuationData }}</h2>
          </div>

          <div *ngIf="valuation.avgGrowth !== null">
            <div *ngIf="valuation.avgGrowth.fiveYears < 0">
              <h2 style="color: grey;">{{ noValuation }}</h2>
            </div>
          </div>

          <div *ngIf="valuation.avgGrowth !== null">
            <div *ngIf="valuation.avgGrowth.fiveYears > 0">
              <!-- Valuation -->
              <section class="top-card">
                <h2>
                  <strong>{{ resultLabel }}</strong>
                </h2>
                <h1>
                  <div *ngIf="valuation.resultLabel === 'Undervalued'">
                    <app-stock-card
                      [value]="valuation.resultPercent"
                      label="{{upsidePotentialLabel}}"
                      color="green">
                    </app-stock-card>
                  </div>
                  <div *ngIf="valuation.resultLabel === 'Overvalued'">
                    <app-stock-card
                      [value]="valuation.resultPercent"
                      label="{{downsidePotentialLabel}}"
                      color="red">
                    </app-stock-card>
                  </div>
                </h1>
                <h3>
                  <span *ngIf="valuation.resultLabel === 'Undervalued'" class="undervalued">
                    {{ undervaluedLabel }}
                  </span>
                  <span *ngIf="valuation.resultLabel === 'Overvalued'" class="overvalued">
                    {{ overvaluedLabel }}
                  </span>
                </h3>
                <p>
                  <span *ngIf="valuation.resultLabel === 'Undervalued'">
                    {{ undervaluedExplanation }}
                  </span>
                  <span *If="valuation.resultLabel === 'Overvalued'">
                    {{ overvaluedExplanation }}
                  </span>
                </p>
              </section>

              <section class="card">
                <h2>{{ fairPriceLabel }}</h2>
                <h1>${{ uiRounding(valuation.fairPrice) }}</h1>
                <p>{{ fairPriceExplanation }}</p>
              </section>

              <section class="card">
                <h2>{{ howFairPriceWasCalulated }}</h2>
                <h1>{{ valuation.formula }}</h1>
                <p>{{ formulaLabel }}</p>
                <p class="explanation">{{ formulaExplanationLabel }}</p>
              </section>

              <!-- Historical profit -->
              <section *ngIf="valuation.netProfitHistory.length > 0" class="card">
                <h2>{{ netProfitGrowthLabel }}</h2>
                <p><strong>{{ averageIncomeGrowthLabel }}</strong></p>
                <ul>
                  <li><strong>{{ valuation.avgGrowth.fiveYears }}%</strong> - {{ averageFiveYearsGrowth }}</li>
                  <li><strong>{{ valuation.avgGrowth.threeYears }}%</strong> - {{ averageThreeYearsGrowth }}</li>
                  <li><strong>{{ valuation.avgGrowth.ttm }}%</strong> - {{ averageIncomeGrowthTtm }}</li>
                </ul>
                <p>{{ growthRateCalcExplanation }}</p>
                <div class="table-wrapper">
                  <table class="financial-table">
                    <thead>
                      <tr>
                        <th>{{ metricLabel }}</th>
                        <th *ngFor="let item of valuation.netProfitHistory">
                          {{ item.year }}
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>{{ netProfitLabel }}</td>
                        <td *ngFor="let item of valuation.netProfitHistory">
                          {{ item.value | abbreviateNumber }}
                        </td>
                      </tr>
                      <tr style="background-color: rgb(226, 225, 224);">
                        <td>{{ growthLabel }}</td>
                        <td *ngFor="let item of valuation.netProfitHistory; let i = index">
                          <ng-container *ngIf="i > 0">
                            {{
                              ((valuation.netProfitHistory[i].value - valuation.netProfitHistory[i - 1].value)
                                / valuation.netProfitHistory[i - 1].value * 100) | number:'1.0-0'
                            }}%
                          </ng-container>
                          <ng-container *ngIf="i === 0">â€”</ng-container>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </section>

              <section class="card">
                <h2>{{ epsTtmLabel }}</h2>
                <h1>${{ uiRounding(stockInfo.epsTtm) }}</h1>
                <p>{{ epsTtmExplanation }}</p>
              </section>

              <section class="card">
                <h2>{{ pegLabel }}</h2>
                <h1>1</h1>
                <p>{{ pegExplanation }}</p>
              </section>

              <!-- Lynch explanation -->
              <section *ngIf="valuation.avgGrowth.fiveYears > 0" class="card">
                <h2>{{ aboutLynchFormulaLabel }}</h2>
                <p [innerHTML]="aboutLynchFormulaText"></p>
              </section>
            </div>
          </div>
        </app-tab>

        <app-tab title="{{stockInformationLabel}}">
          <!-- Public stock data -->
          <section class="top-card">
            <h2>{{ finanacialOverviewLabel }}</h2>
            <div class="data-grid">
              <div class="grid-cell">
                <h3>{{ marketCapLabel }}</h3>
                <p>{{ stockInfo.capitalization | abbreviateNumber }}</p>
              </div>
              <div class="grid-cell">
                <h3>{{ epsTtmLabelCompanyInfo }}</h3>
                <p>{{ uiRounding(stockInfo.epsTtm) }}</p>
              </div>
              <div class="grid-cell">
                <h3>{{ peTtmLabel }}</h3>
                <p>{{ uiRounding(stockInfo.peTtm) }}</p>
              </div>
              <!--div class="grid-cell">
                <h3>{{ pegLabel }}</h3>
                <p>{{ uiRounding(valuation.peg) }}</p>
              </div-->
              <div class="grid-cell">
                <h3>{{ dividendsYieldLabel }}</h3>
                <p>{{ uiRounding(stockInfo.dividendYield) }}%</p>
              </div>
              <div class="grid-cell">
                <h3>FCF</h3>
                <p>{{ stockInfo.freeCashFlow | abbreviateNumber }}</p>
              </div>
              <div class="grid-cell">
                <h3>D/E</h3>
                <p>{{ uiRounding(stockInfo.debtToEquity) }}</p>
              </div>
            </div>
            <h2>{{ mainStockData }}</h2>
            <div class="info-grid">
              <div>
                <h3>{{ sectorLabel }}</h3>
                <p>{{ stockInfo.sector }}</p>
              </div>
              <div>
                <h3>{{ industryLabel }}</h3>
                <p>{{ stockInfo.industry }}</p>
              </div>
            </div>
          </section>
        </app-tab>
      </app-tabs>
    </div>
</ng-container>

<!-- Skeleton Template -->
<ng-template #loadingSkeleton>
  <div class="valuate-container">
    <h1 class="skeleton-box long"></h1>
    <p class="exchange skeleton-box medium"></p>

    <div class="card">
      <h2 class="skeleton-box medium"></h2>
      <div *ngFor="let i of [1,2,3,4,5,6]" class="skeleton-box short"></div>
    </div>

    <div class="card">
      <h2 class="skeleton-box medium"></h2>
      <div *ngFor="let i of [1,2,3]" class="skeleton-box medium"></div>
    </div>

    <div class="card">
      <h2 class="skeleton-box medium"></h2>
      <div *ngFor="let i of [1,2,3,4,5]" class="skeleton-box long"></div>
    </div>
  </div>
</ng-template>

<!-- Error Template -->
<ng-template #errorTemplate>
  <app-error-state [showHomeButton]="true"></app-error-state>
</ng-template>
